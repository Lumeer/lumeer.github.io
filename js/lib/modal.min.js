!function(global,$){"use strict";var modal={activeElement:void 0,lastActive:void 0,stackedElements:[],tabbableElements:"a[href], area[href], input:not([disabled]),select:not([disabled]), textarea:not([disabled]),button:not([disabled]), iframe, object, embed, *[tabindex],*[contenteditable]",on:function(event,elements,callback){var i=0;if("string"!=typeof event)throw new Error("Type error: `event` has to be a string");if("function"!=typeof callback)throw new Error("Type error: `callback` has to be a function");if(elements)for(elements!==global&&elements.length||(elements=[elements]);i<elements.length;i++)$?$(elements[i]).on(event,callback):"addEventListener"in elements[i]&&elements[i].addEventListener(event,callback,!1)},trigger:function(event,modal){var eventTrigger,eventParams={detail:{modal:modal}};$?$(document).trigger(event,eventParams):(document.createEvent?(eventTrigger=document.createEvent("CustomEvent")).initCustomEvent(event,!1,!1,{modal:modal}):eventTrigger=new CustomEvent(event,eventParams),document.dispatchEvent(eventTrigger))},addClass:function(element,className){element&&!element.className.match(className)&&(element.className+=" "+className)},removeClass:function(element,className){element.className=element.className.replace(className,"").replace("  "," ")},hasClass:function(element,className){return!!element.className.match(className)},setFocus:function(){modal.activeElement&&(modal.lastActive=document.activeElement,modal.activeElement.focus(),modal.keepFocus(modal.activeElement))},removeFocus:function(){modal.lastActive&&modal.lastActive.focus()},keepFocus:function(element){var allTabbableElements=[];try{allTabbableElements=element.querySelectorAll(modal.tabbableElements)}catch(ex){return}var firstTabbableElement=modal.getFirstElementVisible(allTabbableElements),lastTabbableElement=modal.getLastElementVisible(allTabbableElements);modal.on("keydown",element,function(event){9===(event.which||event.keyCode)&&(event.preventDefault=event.preventDefault||function(){event.returnValue=!1},event.target!==lastTabbableElement||event.shiftKey?event.target===firstTabbableElement&&event.shiftKey&&(event.preventDefault(),lastTabbableElement.focus()):(event.preventDefault(),firstTabbableElement.focus()))})},getFirstElementVisible:function(nodeList){var nodeListLength=nodeList.length;if(modal.isElementVisible(nodeList[0]))return nodeList[0];for(var i=1;i<nodeListLength-1;i++)if(modal.isElementVisible(nodeList[i]))return nodeList[i];return null},getLastElementVisible:function(nodeList){var nodeListLength=nodeList.length,lastTabbableElement=nodeList[nodeListLength-1];if(modal.isElementVisible(lastTabbableElement))return lastTabbableElement;for(var i=nodeListLength-1;0<=i;i--)if(modal.isElementVisible(nodeList[i]))return nodeList[i];return null},isElementVisible:function(element){return!(0===element.offsetWidth&&0===element.offsetHeight)},setActive:function(element){modal.addClass(element,"is-active"),modal.activeElement=element,modal.activeElement.setAttribute("aria-hidden","false"),modal.setFocus(element.id),modal.trigger("cssmodal:show",modal.activeElement)},unsetActive:function(isStacked,shouldNotBeStacked){modal.removeClass(document.documentElement,"has-overlay"),modal.activeElement&&(modal.removeClass(modal.activeElement,"is-active"),modal.trigger("cssmodal:hide",modal.activeElement),modal.activeElement.setAttribute("aria-hidden","true"),modal.removeFocus(),isStacked&&!shouldNotBeStacked&&modal.stackModal(modal.activeElement),!isStacked&&0<modal.stackedElements.length&&modal.unstackModal(),modal.activeElement=null)},stackModal:function(stackableModal){modal.addClass(stackableModal,"is-stacked"),modal.stackedElements.push(modal.activeElement)},unstackModal:function(){var stackedCount=modal.stackedElements.length,lastStacked=modal.stackedElements[stackedCount-1];modal.removeClass(lastStacked,"is-stacked"),global.location.hash=lastStacked.id,modal.stackedElements.splice(stackedCount-1,1)},mainHandler:function(event,noHash){var modalElement,modalChild,hash=global.location.hash.replace("#",""),index=0,tmp=[];if(noHash&&(hash=event.currentTarget.getAttribute("href").replace("#","")),modalElement=document.getElementById(hash),-1!==hash.indexOf("/")){if(index=(tmp=hash.split("/")).pop(),hash=tmp.join("/"),!(modalElement=document.getElementById(hash)))throw new Error('ReferenceError: element "'+hash+'" does not exist!');modalElement.index=1*index}if(modalElement){try{event.preventDefault()}catch(ex){event.returnValue=!1}(modalChild=modalElement.children[0])&&modalChild.className.match(/modal-inner/)&&(modal.unsetActive(!modal.hasClass(modalElement,"is-active"),"false"===modalElement.getAttribute("data-stackable")),modal.addClass(document.documentElement,"has-overlay"),modal._currentScrollPositionY=global.scrollY,modal._currentScrollPositionX=global.scrollX,modal.setActive(modalElement),modal.activeElement._noHash=noHash)}else modal.unsetActive();return!0},injectIframes:function(){for(var iframe,iframes=document.querySelectorAll("[data-iframe-src]"),i=0;i<iframes.length;i++)(iframe=document.createElement("iframe")).src=iframes[i].getAttribute("data-iframe-src"),iframe.setAttribute("webkitallowfullscreen",!0),iframe.setAttribute("mozallowfullscreen",!0),iframe.setAttribute("allowfullscreen",!0),iframes[i].appendChild(iframe)},init:function(){this.on("keyup",document,function(event){var hash=global.location.hash.replace("#","");if(27===event.keyCode){if(modal.activeElement&&hash===modal.activeElement.id?global.location.hash="!":modal.unsetActive(),modal.lastActive)return!1;modal.removeFocus()}},!1),this.on("click",document.querySelectorAll("[data-cssmodal-nohash]"),function(event){modal.mainHandler(event,!0)}),this.on("click",document.querySelectorAll(".modal-close"),function(event){modal.activeElement._noHash&&modal.mainHandler(event,!0)}),this.on("hashchange",global,modal.mainHandler),this.on("load",global,modal.mainHandler),global.onscroll=global.onmousewheel=function(){document.documentElement.className.match(/has-overlay/)&&global.scrollTo(modal._currentScrollPositionX,modal._currentScrollPositionY)},modal.injectIframes()}};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=modal:"function"==typeof define&&define.amd?define("CSSModal",[],function(){if(!global.CustomEvent&&!$)throw new Error("This browser doesn't support CustomEvent - please include jQuery.");return modal.init(),modal}):"object"==typeof global&&"object"==typeof global.document&&(global.CSSModal=modal).init()}(window,window.jQuery);